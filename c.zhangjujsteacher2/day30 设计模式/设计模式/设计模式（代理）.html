<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600587 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="389"/>

<div>
<span><div><br/></div><div>这次我们讲的设计模式叫做 Proxy， 代理模式</div><div><br/></div><div>那么代理模式是什么呢？   举个例子</div><div><br/></div><div>明星----》经纪人----》代理与被代理， 拍电影，真人秀 （谈判、行程安排、炒作）</div><div><br/></div><div>代码：</div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function</span> <span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">SuperStar(){</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">拍电影</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">= function(){</span></div><div><br/></div><div><font style="font-size: 11pt;"><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></font></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">真人秀</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">= function(){</span></div><div><br/></div><div><font style="font-size: 11pt;"><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></font></div><div><font style="font-size: 11pt;"><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></font></div><div><br/></div><div><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">function Proxy(){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;"><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">    this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">主人</span> <span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">= new SuperStart();</span></span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;"><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">    this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">找我主人拍电影</span> <span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">= functioin(){</span></span></div><div><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">       </span> <span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(54, 101, 238); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">//</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(54, 101, 238); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">谈价格、谈档期、谈待遇、确定行程计划</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">        if(</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">一切OK</span><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">){</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">            this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">主人</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">拍电影</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">();    </span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">        }</span></div><div><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">    }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;"><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">    this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">找我主人演真人秀</span> <span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">= function(){</span></span></div><div><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">        </span><span style="font-size: 15.199999809265137px; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(251, 250, 248); color: rgb(54, 101, 238); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">//</span><span style="letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(54, 101, 238); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">谈价格、谈档期、谈待遇、确定行程计划</span></span></div><div><span style="letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">        if(</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">一切ok</span><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">){</span></span></div><div><span style="letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(251, 250, 248);"><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">            this.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">主人</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">.</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">真人秀</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">();</span></span></div><div><span style="letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-variant: normal; line-height: 21px;">        }</span></span></div><div><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">    }</span></div><div><span style="font-size: 15px; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 21px;">}</span></div></div><div><br/></div><div>实战练习：  加载图片时的延迟，我们希望真正的图片在加载完成之前都显示一个类似loading的图片,</div><div><br/></div><div>当真的图片完成下载后，再替换掉loading图片</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//非代理模式</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function CreateImage(){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var img = document.create(&quot;img&quot;);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    document.body.appendChild(img);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    img.src = &quot;loading.jpg&quot;; //loading图片</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var cacheImg = new Image();</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    cacheImg.onload = function(){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        img.src = this.src;//当缓存对象加载完成后，将真正的图片放入img</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></div><div><br/></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    this.setSrc = function(url){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        cacheImg.src = url; //使用缓存对象加载真正的图片</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div></div><div><br/></div><div>这样做虽然可以达到效果，但明显CreateImage函数过于复杂，所以现在要简化函数的内容</div><div>让CreateImage职责更单一，只负责加载图片。就可以使用代理模式</div><div><br/></div><div>代码：</div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function CreateImage(){</span></div><div><font style="font-size: 11pt;"><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var img = document.create(&quot;img&quot;);</span></font></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    document.body.appendChild(img);</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    img.src = &quot;loading.jpg&quot;;</span></div><div><font style="font-size: 11pt;"><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">this.setSrc = function(url){</span></font></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    this.src = url; </span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        </span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div><div><br/></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">//代理</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function ProxyImage(){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var target = new CreateImage();</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var img = new Image();</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">img.onload = function(){</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    target.src = this.src;</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    this.setSrc = function(url){</span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 1.45;">    </span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        img.src = url;</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div><div><br/></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var img = new ProxyImage();</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">img.setSrc = &quot;realimg.jpg&quot;;</span></div></div><div><br/></div><div>实战练习： 如何给一个ajax请求增加缓存？</div><div><br/></div><div>假设现在有一个ajax请求函数：</div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function ajax(type, url, success){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var req = new XMLHttpRequest();</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    req.open(type, url, sync);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    req.onreadystatechange = function(){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        if(req.status == 200 &amp;&amp; req.readyState == 4){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">            success.call(null, req.responseText);    </span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    req.send();</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div></div><div><br/></div><div>增加缓存机制，每个请求过的ajax，5分钟内再次请求，从缓存中直接获取数据不再像服务器发送请求。</div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var proxyAjax = (function(){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    var cache = {};</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    return function(type, url, success){</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        //</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">判断缓存是否存在，存在则直接返回</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        if(!!cache[url])  </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; line-height: 1.45;">return </span><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco; line-height: 1.45;">cache[url];</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        //</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">调用ajax函数，在请求结束时，将请求的数据先缓存起来</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        ajax(type, url, function(data){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">            cache[url] = data;</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">            setTimeout(function(){ //</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">设置该url的缓存时间为5分钟</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">                cache[url] = undefined;</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">            },300*1000);</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">            //</span><span style="background-color: rgb(251, 250, 248); font-size: 10pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">调用真正的回调函数</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">            success(data);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">        });</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">    }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 11pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">})();</span></div></div><div><br/></div><div>这就是代理模式，以上。</div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 