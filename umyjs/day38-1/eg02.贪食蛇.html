<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #mycanvas {
            display: block;
            margin: 50px auto;
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <canvas id="mycanvas" width="400" height="400"></canvas>
    <script>
        let canvas = document.getElementById('mycanvas');
        let ctx = canvas.getContext('2d');

        let direction = 2; // 方向 0表示左 1上 2右 3下
        let timer = null; // 计时器
        // 蛇的初始位置
        let x = 8;
        let y = 8;
        let len = 10; // 长度
        let speed = 100;
        let size = 8; // 每一节蛇的大小
        let map = []; // 蛇的运动轨迹

        // 食物的坐标
        let foodX;
        let foodY;

        function game() {
            ctx.fillStyle = "green";

            // 方向判定
            switch (direction) {
                case 0:
                    x = x - size;
                    break;
                case 1:
                    y = y - size;
                    break;
                case 2:
                    x = x + size;
                    break;
                case 3:
                    y = y + size;
                    break;
            }

            // 边界碰撞检测
            if (x >= canvas.width || x < 0 || y >= canvas.height || y < 0) {
                clearInterval(timer);
                alert('game over');
                location.reload();
            }

            // 自身碰撞检测
            let carch = map.some(elm => elm.x === x && elm.y === y);
            if (carch) {
                clearInterval(timer);
                alert('game over');
                location.reload();
            }


            if (map.length > len) { // 当数组的长度大于蛇的最大长度
                //删除数组的第一个元素 并且 擦除画布中对应的位置
                let first = map.shift();
                ctx.clearRect(first.x, first.y, size, size);
            }

            map.push({
                x: x,
                y: y
            });
            // 绘制蛇身
            ctx.fillRect(x, y, size, size);


            // 判断是否吃到食物
            if (foodX === x && foodY === y) {
                len++;
                getFood();
            }
        }

        function getFood() {
            foodX = Math.floor(Math.random() * 50) * 8;
            foodY = Math.floor(Math.random() * 50) * 8;

            let has = map.some(elm => elm.x === foodX && elm.y === foodY);
            if (has) {
                return arguments.callee();
            }

            ctx.fillStyle = 'red';
            ctx.fillRect(foodX, foodY, size, size);
        }
        getFood();
        timer = setInterval(game, speed);


        document.onkeyup = function(e) {
            // 只有按了上下左右键 才会修改 方向
            if (e.keyCode >= 37 && e.keyCode <= 40) direction = e.keyCode - 37;
        }
    </script>
</body>

</html>